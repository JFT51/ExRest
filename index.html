<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Analytics Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
    <div class="fixed-banner">
        <div class="site-logo">
            <img src="https://raw.githubusercontent.com/JFT51/ExRest/refs/heads/main/laqrotte.svg" alt="La Qrotte Logo" class="company-logo">
        </div>
        <button class="hamburger-menu" id="hamburgerMenu" aria-label="Menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        <nav class="tab-menu" id="tabMenu">
            <button class="tab-button active" data-tab="overview">Overview</button>
            <button class="tab-button" data-tab="benchmark">Hourly Benchmark</button>
            <button class="tab-button" data-tab="week-data">Week Data</button>
            <button class="tab-button" data-tab="custom-analytics">Custom Analytics</button>
            <button class="tab-button" data-tab="capture-evolution">Capture Rate Evolution</button>
            <button class="tab-button" data-tab="kpi-explanations">KPI Explanations</button>
        </nav>
    </div>

    <div class="main-content">
        <div id="overview" class="tab-content active">
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-icon"><i class="fas fa-users"></i></div>
                    <div class="kpi-title">Monthly Visitors</div>
                    <div class="kpi-value" id="monthlyVisitors">-</div>
                    <div class="kpi-label">Total Customers</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon"><i class="fas fa-venus-mars"></i></div>
                    <div class="kpi-title">Gender Distribution</div>
                    <div class="kpi-value">
                        <span id="menPercentage">-%</span> / <span id="womenPercentage">-%</span>
                    </div>
                    <div class="kpi-label">Men / Women</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon"><i class="fas fa-bullseye"></i></div>
                    <div class="kpi-title">Capture Rate</div>
                    <div class="kpi-value" id="avgCaptureRate">-%</div>
                    <div class="kpi-label">Monthly Average</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="kpi-title">Conversion Rate</div>
                    <div class="kpi-value" id="conversionRate">-%</div>
                    <div class="kpi-label">Groups / Visitors</div>
                </div>
            </div>

            <div class="ticker-section">
                <div class="ticker-container">
                    <div class="ticker-title">Top 3 Customer Days</div>
                    <div class="ticker-content" id="customersTickerContent">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                <div class="ticker-container">
                    <div class="ticker-title">Top 3 Capture Rate Days</div>
                    <div class="ticker-content" id="captureRateTickerContent">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="month-selector">
                <button id="prevMonth">←</button>
                <h3 id="currentMonth">Loading...</h3>
                <button id="nextMonth">→</button>
            </div>

            <div id="monthly" class="chart-section">
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
                <div class="dataset-selector">
                    <h3>Datasets</h3>
                    <div class="dataset-option customers">
                        <div class="dataset-controls">
                            <input type="checkbox" id="showCustomers" checked>
                            <button class="toggle-labels" data-dataset="customers" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="showCustomers">Daily Customers</label>
                    </div>
                    <div class="dataset-option passersby">
                        <div class="dataset-controls">
                            <input type="checkbox" id="showPassersby" checked>
                            <button class="toggle-labels" data-dataset="passersby" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="showPassersby">Passersby</label>
                    </div>
                    <div class="dataset-option capture-rate">
                        <div class="dataset-controls">
                            <input type="checkbox" id="showCaptureRate" checked>
                            <button class="toggle-labels" data-dataset="capture-rate" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="showCaptureRate">Capture Rate</label>
                    </div>
                </div>
            </div>

            <nav>
                <button id="hourDataBtn">Hour Data</button>
                <button id="dayDataBtn">Day Data</button>
                <button id="weekDataBtn">Week Data</button>
            </nav>

            <div id="noDataSelectedMessage" class="message-container">
                <p>Select a data view above to display information</p>
            </div>

            <div id="hourDataContainer" class="data-container hidden">
                <h2>Hour Data</h2>
                <div class="table-wrapper">
                    <table id="hourDataTable">
                        <thead>
                            <!-- Headers will be inserted by JavaScript -->
                        </thead>
                        <tbody>
                            <!-- Data will be inserted by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="dayDataContainer" class="data-container hidden">
                <h2>Day Data</h2>
                <div class="table-wrapper">
                    <table id="dayDataTable">
                        <thead>
                            <!-- Headers will be inserted by JavaScript -->
                        </thead>
                        <tbody>
                            <!-- Data will be inserted by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="weekDataContainer" class="data-container hidden">
                <h2>Week Data</h2>
                <div class="table-wrapper">
                    <table id="weekDataTable">
                        <thead>
                            <tr>
                                <th>Week</th>
                                <th>Period</th>
                                <th>Visitors</th>
                                <th>Passersby</th>
                                <th>Capture Rate</th>
                                <th>Men/Women</th>
                                <th>Groups</th>
                                <th>Conversion</th>
                                <th>Avg. Dwell Time</th>
                                <th>Accuracy</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="benchmark" class="tab-content">
            <div class="date-picker-sticky">
                <div class="date-picker-container">
                    <label for="benchmarkDate">Select Date:</label>
                    <input type="date" id="benchmarkDate">
                    <div class="benchmark-date-container">
                        <div class="benchmark-toggle">
                            <input type="checkbox" id="enableBenchmark" name="benchmarkType">
                        </div>
                        <label for="benchmarkCompareDate">Compare with:</label>
                        <input type="date" id="benchmarkCompareDate" disabled>
                        <div class="benchmark-toggle average-toggle">
                            <input type="checkbox" id="enableAverageBenchmark" name="benchmarkType">
                            <label for="enableAverageBenchmark">Compare with Average</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="benchmark-table-container">
                <table class="benchmark-comparison">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Customers</th>
                            <th>Passersby</th>
                            <th>Capture Rate</th>
                            <th>Gender Distribution</th>
                            <th>Dwell Time</th>
                            <th>Data Accuracy</th>
                            <th>Weather</th>
                        </tr>
                    </thead>
                    <tbody id="benchmarkTableBody">
                        <tr>
                            <td colspan="8">Select a date to view data</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="capture-rate-cards">
                <div class="capture-card">
                    <h3><i class="fas fa-sun-rise"></i> Morning</h3>
                    <p>07:00 - 11:00</p>
                    <div class="capture-value" id="morningCaptureRate">0.0%</div>
                </div>
                <div class="capture-card">
                    <h3><i class="fas fa-sun"></i> Noon</h3>
                    <p>12:00 - 14:00</p>
                    <div class="capture-value" id="noonCaptureRate">0.0%</div>
                </div>
                <div class="capture-card">
                    <h3><i class="fas fa-sun-set"></i> Afternoon</h3>
                    <p>17:00 - 20:00</p>
                    <div class="capture-value" id="afternoonCaptureRate">0.0%</div>
                </div>
                <div class="capture-card">
                    <h3><i class="fas fa-cog"></i> Custom</h3>
                    <p id="customPeriodLabel">08:00 - 20:00</p>
                    <div class="capture-value" id="customCaptureRate">0.0%</div>
                </div>
                <div class="time-control-card">
                    <div class="time-controls">
                        <div class="time-group">
                            <label>Start Time:</label>
                            <select id="customPeriodStart" class="time-select">
                                <!-- Options will be added by JavaScript -->
                            </select>
                        </div>
                        <div class="time-group">
                            <label>End Time:</label>
                            <select id="customPeriodEnd" class="time-select">
                                <!-- Options will be added by JavaScript -->
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-section">
                <div class="chart-container">
                    <canvas id="benchmarkHourlyChart"></canvas>
                </div>
                <div class="dataset-selector">
                    <h3>Datasets</h3>
                    <div class="dataset-option visitors">
                        <div class="dataset-controls">
                            <input type="checkbox" id="benchmarkShowVisitors" checked>
                            <button class="toggle-labels" data-dataset="visitors" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="benchmarkShowVisitors">Visitors</label>
                    </div>
                    <div class="dataset-option passersby">
                        <div class="dataset-controls">
                            <input type="checkbox" id="benchmarkShowPassersby">
                            <button class="toggle-labels" data-dataset="passersby" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="benchmarkShowPassersby">Passersby</label>
                    </div>
                    <div class="dataset-option capture-rate">
                        <div class="dataset-controls">
                            <input type="checkbox" id="benchmarkShowCaptureRate" checked>
                            <button class="toggle-labels" data-dataset="capture-rate" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="benchmarkShowCaptureRate">Capture Rate</label>
                    </div>
                    <div class="dataset-option conversion">
                        <div class="dataset-controls">
                            <input type="checkbox" id="benchmarkShowConversion">
                            <button class="toggle-labels" data-dataset="conversion" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="benchmarkShowConversion">Conversion</label>
                    </div>
                    <div class="dataset-option men">
                        <div class="dataset-controls">
                            <input type="checkbox" id="benchmarkShowMen">
                            <button class="toggle-labels" data-dataset="men" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="benchmarkShowMen">Men</label>
                    </div>
                    <div class="dataset-option women">
                        <div class="dataset-controls">
                            <input type="checkbox" id="benchmarkShowWomen">
                            <button class="toggle-labels" data-dataset="women" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="benchmarkShowWomen">Women</label>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-data" class="tab-content">
            <div class="date-picker-sticky">
                <div class="date-picker-container">
                    <label for="weekDataDate">Select Week:</label>
                    <input type="date" id="weekDataDate">
                    <div class="benchmark-date-container">
                        <div class="benchmark-toggle">
                            <input type="checkbox" id="enableWeekDataBenchmark" name="benchmarkType">
                        </div>
                        <label for="weekDataCompareDate">Compare with:</label>
                        <input type="date" id="weekDataCompareDate" disabled>
                        <div class="benchmark-toggle average-toggle">
                            <input type="checkbox" id="enableWeekDataAverageBenchmark" name="benchmarkType">
                            <label for="enableWeekDataAverageBenchmark">Compare with Average</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="benchmark-table-container">
                <table class="benchmark-comparison">
                    <thead>
                        <tr>
                            <th>Week</th>
                            <th>Total Visitors</th>
                            <th>Daily Average</th>
                            <th>Total Passersby</th>
                            <th>Capture Rate</th>
                            <th>Gender Distribution</th>
                            <th>Avg. Dwell Time</th>
                            <th>Data Accuracy</th>
                        </tr>
                    </thead>
                    <tbody id="weekDataTableBody">
                        <tr>
                            <td colspan="8">Select a week to view data</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="capture-rate-cards">
                <div class="capture-card">
                    <h3><i class="fas fa-calendar-day"></i> Weekdays</h3>
                    <p>Monday - Friday</p>
                    <div class="capture-value" id="weekdaysCaptureRate">0.0%</div>
                </div>
                <div class="capture-card">
                    <h3><i class="fas fa-calendar-week"></i> Weekend</h3>
                    <p>Saturday - Sunday</p>
                    <div class="capture-value" id="weekendCaptureRate">0.0%</div>
                </div>
                <!-- Full Week capture rate card removed -->
                <div class="capture-card">
                    <h3><i class="fas fa-cog"></i> Custom</h3>
                    <p id="customDaysLabel">Select days</p>
                    <div class="capture-value" id="customDaysCaptureRate">0.0%</div>
                </div>
                <div class="time-control-card">
                    <div class="time-controls">
                        <div class="weekday-group">
                            <label><input type="checkbox" value="1" class="weekday-checkbox"><span data-full="Monday" data-short="Mon">Monday</span></label>
                            <label><input type="checkbox" value="2" class="weekday-checkbox"><span data-full="Tuesday" data-short="Tue">Tuesday</span></label>
                            <label><input type="checkbox" value="3" class="weekday-checkbox"><span data-full="Wednesday" data-short="Wed">Wednesday</span></label>
                            <label><input type="checkbox" value="4" class="weekday-checkbox"><span data-full="Thursday" data-short="Thu">Thursday</span></label>
                            <label><input type="checkbox" value="5" class="weekday-checkbox"><span data-full="Friday" data-short="Fri">Friday</span></label>
                            <label><input type="checkbox" value="6" class="weekday-checkbox"><span data-full="Saturday" data-short="Sat">Saturday</span></label>
                            <label><input type="checkbox" value="0" class="weekday-checkbox"><span data-full="Sunday" data-short="Sun">Sunday</span></label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-section">
                <div class="chart-container">
                    <canvas id="weekDataChart"></canvas>
                </div>
                <div class="dataset-selector">
                    <h3>Datasets</h3>
                    <div class="dataset-option visitors">
                        <div class="dataset-controls">
                            <input type="checkbox" id="weekDataShowVisitors" checked>
                            <button class="toggle-labels" data-dataset="visitors" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="weekDataShowVisitors">Visitors</label>
                    </div>
                    <div class="dataset-option passersby">
                        <div class="dataset-controls">
                            <input type="checkbox" id="weekDataShowPassersby">
                            <button class="toggle-labels" data-dataset="passersby" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="weekDataShowPassersby">Passersby</label>
                    </div>
                    <div class="dataset-option capture-rate">
                        <div class="dataset-controls">
                            <input type="checkbox" id="weekDataShowCaptureRate" checked>
                            <button class="toggle-labels" data-dataset="capture-rate" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="weekDataShowCaptureRate">Capture Rate</label>
                    </div>
                    <div class="dataset-option conversion">
                        <div class="dataset-controls">
                            <input type="checkbox" id="weekDataShowConversion">
                            <button class="toggle-labels" data-dataset="conversion" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="weekDataShowConversion">Conversion</label>
                    </div>
                    <div class="dataset-option men">
                        <div class="dataset-controls">
                            <input type="checkbox" id="weekDataShowMen">
                            <button class="toggle-labels" data-dataset="men" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="weekDataShowMen">Men</label>
                    </div>
                    <div class="dataset-option women">
                        <div class="dataset-controls">
                            <input type="checkbox" id="weekDataShowWomen">
                            <button class="toggle-labels" data-dataset="women" title="Toggle data labels">
                                <i class="fas fa-tag"></i>
                            </button>
                        </div>
                        <label for="weekDataShowWomen">Women</label>
                    </div>
                </div>
            </div>
        </div>
        <!-- Daily Benchmark tab content removed -->

        <div id="custom-analytics" class="tab-content">
            <p class="subtitle">Select options to create your custom analytics view</p>

            <div class="analytics-container">
                <div class="options-panel">
                    <div class="option-section generate-button-section">
                        <button id="generateChart" class="generate-button">Generate Chart</button>
                    </div>

                    <div class="option-section">
                        <h2>Date Range</h2>
                        <div class="date-range">
                            <div class="date-input">
                                <label for="startDate">Start Date:</label>
                                <input type="date" id="startDate">
                            </div>
                            <div class="date-input">
                                <label for="endDate">End Date:</label>
                                <input type="date" id="endDate">
                            </div>
                        </div>
                    </div>

                    <div class="option-section">
                        <h2>Time Period</h2>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="period" value="hours">
                                <span>Hours</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="period" value="days" checked>
                                <span>Days</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="period" value="weeks">
                                <span>Weeks</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="period" value="months">
                                <span>Months</span>
                            </label>
                        </div>
                    </div>

                    <div class="option-section">
                        <h2>Hour Range</h2>
                        <div class="time-range">
                            <div class="time-input">
                                <label for="startHour">Start Hour:</label>
                                <select id="startHour">
                                    <!-- Options will be added by JavaScript -->
                                </select>
                            </div>
                            <div class="time-input">
                                <label for="endHour">End Hour:</label>
                                <select id="endHour">
                                    <!-- Options will be added by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="option-section">
                        <h2>Day Selection</h2>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="day" value="monday" checked>
                                <span>Monday</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="day" value="tuesday" checked>
                                <span>Tuesday</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="day" value="wednesday" checked>
                                <span>Wednesday</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="day" value="thursday" checked>
                                <span>Thursday</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="day" value="friday" checked>
                                <span>Friday</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="day" value="saturday" checked>
                                <span>Saturday</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="day" value="sunday" checked>
                                <span>Sunday</span>
                            </label>
                        </div>
                        <div class="select-buttons">
                            <button id="selectAllDays">Select All</button>
                            <button id="deselectAllDays">Deselect All</button>
                        </div>
                    </div>

                    <div class="option-section">
                        <h2>KPI Selection</h2>
                        <div class="checkbox-group kpi-group">
                            <div class="kpi-column">
                                <h3>Bar Charts</h3>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="visitorsIn" checked>
                                    <span>Visitors</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="passersby">
                                    <span>Passersby</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="visitorsOut">
                                    <span>Visitors Leaving</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="menIn">
                                    <span>Men Entering</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="menOut">
                                    <span>Men Leaving</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="womenIn">
                                    <span>Women Entering</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="womenOut">
                                    <span>Women Leaving</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="groupIn">
                                    <span>Group Entering</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="groupOut">
                                    <span>Group Leaving</span>
                                </label>
                            </div>
                            <div class="kpi-column">
                                <h3>Line Charts</h3>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="captureRate">
                                    <span>Capture Rate</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="conversionRate">
                                    <span>Conversion Rate</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="dwellTime">
                                    <span>Dwell Time</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="kpi" value="weather">
                                    <span>Weather</span>
                                </label>
                            </div>
                        </div>
                        <div class="select-buttons">
                            <button id="selectAllKPIs">Select All</button>
                            <button id="deselectAllKPIs">Deselect All</button>
                        </div>
                    </div>

                    <div class="option-section">
                        <h2>Data Labels</h2>
                        <div class="slider-container">
                            <label class="switch">
                                <input type="checkbox" id="dataLabelsToggle" checked>
                                <span class="slider round"></span>
                            </label>
                            <span id="dataLabelsStatus">Show Data Labels</span>
                        </div>
                    </div>

                    <!-- Generate Chart button moved to the top -->
                </div>

                <div class="chart-panel">
                    <div class="chart-container">
                        <canvas id="analyticsChart"></canvas>
                    </div>
                    <div class="no-data-message">
                        <i class="fas fa-chart-line"></i>
                        <p>Select options and click "Generate Chart" to view data</p>
                    </div>
                    <div class="loading-indicator" id="analyticsLoadingIndicator">
                        <div class="spinner">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <p>Processing data...</p>
                        <div class="progress-text">Preparing complex calculations</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="capture-evolution" class="tab-content">
            <h2>Capture Rate Evolution</h2>
            <p class="subtitle">Analyze capture rate trends over different time periods</p>

            <!-- First Chart: Capture rates by time of day -->
            <div class="chart-section">
                <h3>Capture Rate by Time of Day</h3>
                <p>Shows capture rates for morning (07:00-10:00), noon (12:00-14:00), afternoon (17:00-20:00), and daily average (during restaurant opening hours)</p>
                <div class="chart-controls">
                    <button id="timeOfDayLabelsToggle" class="toggle-button">
                        <i class="fas fa-tag"></i> Show Data Labels
                    </button>
                </div>
                <div class="days-toggle-container">
                    <div class="days-toggle-label">Days:</div>
                    <div class="days-toggle-buttons">
                        <button id="toggleMonday" class="day-toggle-button active" data-day="1">Mon</button>
                        <button id="toggleTuesday" class="day-toggle-button active" data-day="2">Tue</button>
                        <button id="toggleWednesday" class="day-toggle-button active" data-day="3">Wed</button>
                        <button id="toggleThursday" class="day-toggle-button active" data-day="4">Thu</button>
                        <button id="toggleFriday" class="day-toggle-button active" data-day="5">Fri</button>
                        <button id="toggleSaturday" class="day-toggle-button active" data-day="6">Sat</button>
                        <button id="toggleSunday" class="day-toggle-button active" data-day="0">Sun</button>
                    </div>
                </div>
                <div class="series-toggle-container">
                    <div class="series-toggle-buttons">
                        <button id="toggleMorning" class="series-toggle-button active" data-series="morning">
                            <span class="color-indicator" style="background-color: rgba(255, 99, 132, 1)"></span>
                            Morning (07:00-10:00)
                        </button>
                        <button id="toggleNoon" class="series-toggle-button active" data-series="noon">
                            <span class="color-indicator" style="background-color: rgba(255, 159, 64, 1)"></span>
                            Noon (12:00-14:00)
                        </button>
                        <button id="toggleAfternoon" class="series-toggle-button active" data-series="afternoon">
                            <span class="color-indicator" style="background-color: rgba(75, 192, 192, 1)"></span>
                            Afternoon (17:00-20:00)
                        </button>
                        <button id="toggleDaily" class="series-toggle-button active" data-series="daily">
                            <span class="color-indicator" style="background-color: rgba(45, 107, 34, 1)"></span>
                            Daily Average
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="captureTimeOfDayChart"></canvas>
                </div>
            </div>

            <!-- Second Chart: Custom time frame capture rates -->
            <div class="chart-section">
                <h3>Custom Time Frame Capture Rate</h3>
                <p>Shows capture rates for a custom time range (all hours, not limited to restaurant opening hours)</p>
                <div class="time-selector-container">
                    <div class="time-selector">
                        <label for="customStartTime">Start Time:</label>
                        <select id="customStartTime"></select>
                    </div>
                    <div class="time-selector">
                        <label for="customEndTime">End Time:</label>
                        <select id="customEndTime"></select>
                    </div>
                    <button id="updateCustomTimeChart" class="update-button">Update Chart</button>
                </div>
                <div class="chart-controls">
                    <button id="customTimeLabelsToggle" class="toggle-button">
                        <i class="fas fa-tag"></i> Show Data Labels
                    </button>
                </div>
                <div class="days-toggle-container">
                    <div class="days-toggle-label">Days:</div>
                    <div class="days-toggle-buttons">
                        <button id="customToggleMonday" class="day-toggle-button active" data-day="1">Mon</button>
                        <button id="customToggleTuesday" class="day-toggle-button active" data-day="2">Tue</button>
                        <button id="customToggleWednesday" class="day-toggle-button active" data-day="3">Wed</button>
                        <button id="customToggleThursday" class="day-toggle-button active" data-day="4">Thu</button>
                        <button id="customToggleFriday" class="day-toggle-button active" data-day="5">Fri</button>
                        <button id="customToggleSaturday" class="day-toggle-button active" data-day="6">Sat</button>
                        <button id="customToggleSunday" class="day-toggle-button active" data-day="0">Sun</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="captureCustomTimeChart"></canvas>
                </div>
            </div>

            <!-- Third Chart: Weekly average capture rates -->
            <div class="chart-section">
                <h3>Weekly Average Capture Rate</h3>
                <p>Shows the average daily capture rate for each week (during restaurant opening hours)</p>
                <div class="chart-controls">
                    <button id="weeklyLabelsToggle" class="toggle-button">
                        <i class="fas fa-tag"></i> Show Data Labels
                    </button>
                </div>
                <div class="days-toggle-container">
                    <div class="days-toggle-label">Days:</div>
                    <div class="days-toggle-buttons">
                        <button id="weeklyToggleMonday" class="day-toggle-button active" data-day="1">Mon</button>
                        <button id="weeklyToggleTuesday" class="day-toggle-button active" data-day="2">Tue</button>
                        <button id="weeklyToggleWednesday" class="day-toggle-button active" data-day="3">Wed</button>
                        <button id="weeklyToggleThursday" class="day-toggle-button active" data-day="4">Thu</button>
                        <button id="weeklyToggleFriday" class="day-toggle-button active" data-day="5">Fri</button>
                        <button id="weeklyToggleSaturday" class="day-toggle-button active" data-day="6">Sat</button>
                        <button id="weeklyToggleSunday" class="day-toggle-button active" data-day="0">Sun</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="captureWeeklyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- KPI Explanations Tab -->
        <div id="kpi-explanations" class="tab-content">
            <h2>KPI Explanations</h2>
            <p>This page provides detailed explanations of how each Key Performance Indicator (KPI) is calculated on each tab of the dashboard.</p>

            <div class="explanation-section">
                <h3>Overview Tab</h3>
                <div class="kpi-explanation">
                    <h4>Monthly Visitors</h4>
                    <p>This KPI represents the total number of people who entered the restaurant during the current month.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Sum of all visitor counts for the current month
                    </div>
                    <div class="details">
                        <p>The system counts each person who enters through the door as detected by the people counter sensors. This metric is important for understanding overall foot traffic and is a key input for calculating the capture rate.</p>
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Monthly Passersby</h4>
                    <p>This KPI represents the total number of people who walked past the restaurant during the current month.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Sum of all passersby counts for the current month during restaurant opening hours
                    </div>
                    <div class="details">
                        <p>Passersby are detected by external sensors that count people walking in front of the restaurant. This metric is used as the denominator when calculating capture rate.</p>
                    </div>
                    <div class="note">
                        <strong>Note:</strong> Only counted during restaurant opening hours:<br>
                        • Monday-Friday: 07:00-20:00<br>
                        • Saturday: 08:00-20:00<br>
                        • Sunday: 08:00-16:00
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Capture Rate</h4>
                    <p>This KPI measures the percentage of people passing by the restaurant who decided to enter.</p>
                    <div class="formula">
                        <strong>Formula:</strong> (Monthly Visitors ÷ Monthly Passersby) × 100%
                    </div>
                    <div class="details">
                        <p>The capture rate is a critical metric for evaluating the restaurant's ability to attract potential customers. It helps assess the effectiveness of external marketing, signage, and the restaurant's visual appeal.</p>
                    </div>
                    <div class="note">
                        <strong>Note:</strong> Calculated using data only during restaurant opening hours
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Conversion Rate</h4>
                    <p>This KPI measures the percentage of visitors who made a purchase (formed a group).</p>
                    <div class="formula">
                        <strong>Formula:</strong> (Total Groups ÷ Total Visitors) × 100%
                    </div>
                    <div class="details">
                        <p>The conversion rate helps evaluate how effectively the restaurant converts visitors into paying customers. A higher conversion rate indicates that more visitors are making purchases rather than just browsing or leaving without buying anything.</p>
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Average Group Size</h4>
                    <p>This KPI represents the average number of customers per transaction or group.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Total Customers ÷ Total Groups
                    </div>
                    <div class="details">
                        <p>This metric helps understand typical dining patterns. A higher average group size might indicate more family or group dining experiences, while a lower number might suggest more individual or couple visits.</p>
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Average Ticket</h4>
                    <p>This KPI represents the average amount spent per transaction.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Total Revenue ÷ Total Groups
                    </div>
                    <div class="details">
                        <p>The average ticket value is a key indicator of sales performance. It helps evaluate pricing strategies, upselling effectiveness, and overall revenue generation per transaction.</p>
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Revenue per Customer</h4>
                    <p>This KPI represents the average amount spent by each individual customer.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Total Revenue ÷ Total Customers
                    </div>
                    <div class="details">
                        <p>This metric provides insight into individual spending patterns. It's useful for menu pricing decisions and for evaluating the effectiveness of promotions aimed at increasing individual customer spend.</p>
                    </div>
                </div>
            </div>

            <div class="explanation-section">
                <h3>Hourly Benchmark Tab</h3>
                <div class="kpi-explanation">
                    <h4>Hourly Visitors</h4>
                    <p>This KPI shows the average number of visitors per hour for each day of the week.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Sum of visitors for a specific hour and day ÷ Number of occurrences of that day in the dataset
                    </div>
                    <div class="details">
                        <p>This metric helps identify peak hours and traffic patterns throughout the week. It's calculated by averaging the visitor count for each specific hour (e.g., Monday at 12:00) across all weeks in the dataset.</p>
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Hourly Passersby</h4>
                    <p>This KPI shows the average number of people passing by the restaurant per hour for each day of the week.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Sum of passersby for a specific hour and day ÷ Number of occurrences of that day in the dataset
                    </div>
                    <div class="details">
                        <p>This metric helps understand foot traffic patterns outside the restaurant throughout different hours and days. It's used as the denominator when calculating hourly capture rates.</p>
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Hourly Capture Rate</h4>
                    <p>This KPI shows the percentage of passersby who entered the restaurant during each hour of operation.</p>
                    <div class="formula">
                        <strong>Formula:</strong> (Hourly Visitors ÷ Hourly Passersby) × 100%
                    </div>
                    <div class="details">
                        <p>The hourly capture rate helps identify specific times when the restaurant is more or less effective at attracting customers. This can inform staffing decisions, special promotions, or menu adjustments for specific time periods.</p>
                    </div>
                    <div class="note">
                        <strong>Note:</strong> Only calculated during restaurant opening hours. Hours with zero passersby are excluded from the calculation to avoid division by zero.
                    </div>
                </div>
            </div>

            <div class="explanation-section">
                <h3>Week Data Tab</h3>
                <div class="kpi-explanation">
                    <h4>Daily Visitors</h4>
                    <p>This KPI shows the average number of visitors for each day of the week.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Sum of all visitor counts for a specific day ÷ Number of occurrences of that day in the dataset
                    </div>
                    <div class="details">
                        <p>This metric provides insight into which days of the week typically have the highest and lowest visitor counts. It helps with weekly staffing planning and identifying days that might need special attention or promotions.</p>
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Daily Passersby</h4>
                    <p>This KPI shows the average number of people passing by the restaurant for each day of the week.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Sum of all passersby counts for a specific day ÷ Number of occurrences of that day in the dataset
                    </div>
                    <div class="details">
                        <p>This metric helps understand weekly patterns in foot traffic outside the restaurant. It's used as the denominator when calculating daily capture rates.</p>
                    </div>
                    <div class="note">
                        <strong>Note:</strong> Only counted during restaurant opening hours for each day
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Daily Capture Rate</h4>
                    <p>This KPI shows the percentage of passersby who entered the restaurant for each day of the week.</p>
                    <div class="formula">
                        <strong>Formula:</strong> (Daily Visitors ÷ Daily Passersby) × 100%
                    </div>
                    <div class="details">
                        <p>The daily capture rate helps identify which days of the week the restaurant is most effective at attracting customers. This can inform marketing strategies targeted at specific days with lower capture rates.</p>
                    </div>
                    <div class="note">
                        <strong>Note:</strong> Only calculated during restaurant opening hours for each day. Days with zero passersby are excluded from the calculation.
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Daily Revenue</h4>
                    <p>This KPI shows the average revenue generated for each day of the week.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Sum of all transaction amounts for a specific day ÷ Number of occurrences of that day in the dataset
                    </div>
                    <div class="details">
                        <p>This metric provides insight into which days generate the most revenue. When compared with visitor counts, it can reveal days when customers spend more or less per visit.</p>
                    </div>
                </div>
            </div>

            <div class="explanation-section">
                <h3>Custom Analytics Tab</h3>
                <div class="kpi-explanation">
                    <h4>Custom Date Range Visitors</h4>
                    <p>This KPI shows the total number of visitors during the user-selected date range.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Sum of all visitor counts within the selected date range
                    </div>
                    <div class="details">
                        <p>This metric allows for analysis of visitor patterns during specific time periods of interest, such as during promotions, holidays, or special events.</p>
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Custom Date Range Capture Rate</h4>
                    <p>This KPI shows the percentage of passersby who entered the restaurant during the user-selected date range.</p>
                    <div class="formula">
                        <strong>Formula:</strong> (Total Visitors in date range ÷ Total Passersby in date range) × 100%
                    </div>
                    <div class="details">
                        <p>This metric allows for analysis of the restaurant's ability to attract customers during specific time periods, which can be useful for evaluating the effectiveness of seasonal promotions or external factors.</p>
                    </div>
                    <div class="note">
                        <strong>Note:</strong> Only calculated using data during restaurant opening hours within the selected date range
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Custom Date Range Revenue</h4>
                    <p>This KPI shows the total revenue generated during the user-selected date range.</p>
                    <div class="formula">
                        <strong>Formula:</strong> Sum of all transaction amounts within the selected date range
                    </div>
                    <div class="details">
                        <p>This metric allows for revenue analysis during specific time periods, which can help evaluate the financial impact of promotions, menu changes, or external events.</p>
                    </div>
                </div>
            </div>

            <div class="explanation-section">
                <h3>Capture Rate Evolution Tab</h3>
                <div class="kpi-explanation">
                    <h4>Time of Day Capture Rate</h4>
                    <p>This KPI shows the capture rate broken down by different times of day over the selected period.</p>
                    <div class="formula">
                        <strong>Morning (07:00-10:00):</strong> (Morning Visitors ÷ Morning Passersby) × 100%<br>
                        <strong>Noon (12:00-14:00):</strong> (Noon Visitors ÷ Noon Passersby) × 100%<br>
                        <strong>Afternoon (17:00-20:00):</strong> (Afternoon Visitors ÷ Afternoon Passersby) × 100%<br>
                        <strong>Daily Average:</strong> (Daily Visitors ÷ Daily Passersby) × 100%
                    </div>
                    <div class="details">
                        <p>This metric provides insight into how the restaurant's ability to attract customers varies throughout the day. It can help identify specific time periods that might need attention or that show particularly strong performance.</p>
                    </div>
                    <div class="note">
                        <strong>Note:</strong> Days with zero passersby during a specific time period are excluded from the calculation for that time period. The daily average is calculated only during restaurant opening hours.
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Custom Time Frame Capture Rate</h4>
                    <p>This KPI shows the capture rate for a user-defined time range across the selected period.</p>
                    <div class="formula">
                        <strong>Formula:</strong> (Visitors during selected hours ÷ Passersby during selected hours) × 100%
                    </div>
                    <div class="details">
                        <p>This metric allows for analysis of capture rate during specific hours of interest. It's useful for evaluating the effectiveness of time-specific promotions or understanding customer behavior during particular hours.</p>
                    </div>
                    <div class="note">
                        <strong>Note:</strong> This uses the hours defined in the time selector and is not limited to restaurant opening hours. Days with zero passersby during the selected hours are excluded from the calculation.
                    </div>
                </div>

                <div class="kpi-explanation">
                    <h4>Weekly Capture Rate</h4>
                    <p>This KPI shows the average capture rate for each week in the dataset.</p>
                    <div class="formula">
                        <strong>Formula:</strong> (Total Weekly Visitors ÷ Total Weekly Passersby) × 100%
                    </div>
                    <div class="details">
                        <p>This metric helps track the restaurant's performance in attracting customers over time. It can reveal trends, seasonal patterns, or the impact of long-term changes in marketing or operations.</p>
                    </div>
                    <div class="note">
                        <strong>Note:</strong> Only calculated using data during restaurant opening hours. Weeks with zero passersby are excluded from the calculation.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- First load utils since other files depend on its helper functions -->
    <script src="utils.js"></script>

    <!-- Load core data handling next -->
    <script src="data.js"></script>

    <!-- Load chart utilities -->
    <script src="chartUtils.js"></script>
    <script src="download-buttons.js"></script>

    <!-- Load individual chart modules -->
    <script src="monthlyChart.js"></script>
    <script src="benchmarkHourlyChart.js"></script>
    <script src="weekDataChart.js"></script>
    <script src="weekData.js"></script>

    <!-- Load UI components that depend on data -->
    <script src="display.js"></script>
    <script src="navigation.js"></script>
    <script src="benchmark.js"></script>

    <!-- Load custom analytics script (separate to avoid conflicts) -->
    <script src="customAnalytics.js"></script>

    <!-- Load capture evolution script (separate to avoid conflicts) -->
    <script src="captureEvolution.js"></script>

    <!-- Load app initialization last -->
    <script src="app.js"></script>
</body>
</html>
